# 情感支持插件

这个插件用于检测用户消息中的抑郁或负面情绪，并自动生成安慰回复。

## 功能特点

- 自动检测群聊和私聊消息中的负面情绪
- 使用 SnowNLP 进行情感分析，识别可能需要安慰的用户
- 调用 DeepSeek AI 生成符合千早爱音角色设定的安慰回复
- 支持白名单机制，只对特定群聊或用户生效
- 可自定义情感阈值，调整触发条件
- 避免命令前缀消息触发，防止与其他插件冲突

## 安装要求

- Python 3.8 及以上版本
- SnowNLP 库：`pip install snownlp`
- Requests 库：`pip install requests`

## 配置方法

1. 复制 `config\config.toml.example` 到 `config\config.toml`
2. 编辑 `config.toml` 文件：
   - 填入 DeepSeek API 密钥
   - 设置白名单群组和用户ID
   - 调整情感阈值和模型参数
   - 设置需要忽略的命令前缀列表

```toml
# 示例配置
api_key = "你的DeepSeek密钥"

[whitelist]
group_ids = [123456789]
user_ids = [987654321]

[sentiment]
threshold = 0.2

[model]
default = "deepseek-chat"
temperature = 0.7

# 忽略的命令前缀列表，这些前缀开头的消息不会触发情感分析
ignore_commands_prefixes = [
    "点歌", "ds ", "Github", "微博热榜", "/", 
    "抖音热榜", "知乎热榜", "查询记录",
    "虎扑热榜", "贴吧热榜", "百度热搜", "热榜", "热搜"
]
```

## 使用说明

插件会自动运行，无需手动触发。当白名单中的用户发送情感值低于阈值的消息时，会自动回复安慰文本。

### 命令前缀识别

插件会自动识别以下命令前缀，避免误触发：
- `点歌` - 音乐卡片插件命令
- `ds ` - DeepSeek AI插件命令
- `Github` - GitHub插件命令
- `微博热榜` - 微博热榜插件命令
- `抖音热榜` - 抖音热榜插件命令
- `知乎热榜` - 知乎热榜插件命令
- `查询记录` - 聊天记录插件命令
- `/` - 通用命令前缀
- `虎扑热榜` - 虎扑社区热榜插件命令
- `贴吧热榜` - 百度贴吧热榜插件命令
- `百度热搜` - 百度热搜插件命令
- `热榜` - 综合热榜插件命令
- `热榜标签` - 热榜标签查询命令
- `热搜` - 热搜命令（综合热榜别名）
- `热搜标签` - 热搜标签查询命令（热榜标签别名）

您可以在配置文件中自定义需要忽略的命令前缀列表。

## 工作原理

1. 插件接收到消息后检查是否以命令前缀开头
2. 如果不是命令，则检查用户或群组是否在白名单中
3. 使用 SnowNLP 分析消息情感值（0-1之间，越低越消极）
4. 当情感值低于设定阈值时，调用 DeepSeek API 生成安慰回复
5. 将生成的安慰文本直接回复给用户

## 安慰文本生成

安慰文本基于千早爱音角色设定，包含以下特点：
- 表面轻快但隐含细腻观察的语气
- 适当穿插英语短语
- 包含肢体动作描写和台词组合
- 引用乐队相关元素
- 体现角色背景和成长弧线

## 注意事项

- API 密钥不应该提交到代码仓库
- 确保 SnowNLP 库正确安装并能够运行
- 插件目前使用文本回复，未来可能支持语音回复功能