# 聊天记录插件

聊天记录插件是一个用于记录群聊消息的插件，能够保存文本、图片、音频等多种类型的消息，并支持超级管理员使用 DeepSeek 模型对用户进行风格化锐评。

## 功能特点

- **多类型消息记录**：支持记录文本、图片、音频、视频和文件类型的消息
- **媒体文件存储**：自动下载和保存图片，复制音频文件到本地避免丢失
- **层级目录结构**：按照 `群组ID/用户ID` 的结构组织消息记录
- **风格化锐评**：支持使用 DeepSeek AI 模型以多种风格对用户发言进行锐评
- **超管权限控制**：仅超级管理员可以使用锐评功能
- **白名单控制**：可以配置群组和用户白名单

## 配置文件

配置文件 `config.toml` 结构如下：

```toml
# DeepSeek API 密钥配置
api_key = "your_api_key_here"

# 白名单配置
[whitelist]
# 允许使用此插件的群组ID列表
group_ids = [123456789, 987654321]
# 允许使用此插件的用户ID列表
user_ids = [123456789, 987654321]
# 超级管理员ID列表
admin_ids = [123456789]
```

## 支持的命令

### 群聊命令
此插件主要在后台自动记录群聊消息，不提供群聊交互命令。

### 私聊命令（仅限超级管理员）

- `/cr_list_users` - 列出所有有记录的用户
- `/cr_select_user [用户ID]` - 选择要锐评的用户
- `/cr_set_style [风格]` - 设置锐评风格 (sunba/nuclear/nga/zhihu)
- `/cr_criticize` - 对选中的用户进行锐评
- `/cr_help` - 显示帮助信息

## 锐评风格

插件支持四种锐评风格：

1. **孙吧风格** (sunba)：充满嘲讽，使用典型的孙吧网络语言，包含恶搞和滑稽的要素
2. **核战避难吧风格** (nuclear)：体现出黑暗、反讽、末日氛围，掺杂政治隐喻和阴谋论调侃
3. **NGA风格** (nga)：像资深游戏玩家，使用游戏术语，充满戾气和直男癌的发言方式
4. **知乎风格** (zhihu)：像一个傲慢的精英主义者，用假装客观的语言表达自己的优越感

## 数据存储

插件将数据存储在以下目录：

- `data\[群组ID]\[用户ID]\messages.json` - 用户消息记录
- `data\images\[群组ID]\[用户ID]\` - 图片文件
- `data\audio\[群组ID]\[用户ID]\` - 音频文件
- `data\video\[群组ID]\[用户ID]\` - 视频相关信息
- `data\file\[群组ID]\[用户ID]\` - 文件相关信息

## 注意事项

1. 请确保配置了有效的 DeepSeek API 密钥才能使用锐评功能
2. 音频文件保存功能会复制原始音频文件，以防止临时文件被系统清理
3. 如果文件复制失败，系统会自动进行多次重试
4. 锐评功能仅使用文本消息进行分析，不会包含媒体文件内容
5. 本插件自动记录群聊消息，不提供查询功能